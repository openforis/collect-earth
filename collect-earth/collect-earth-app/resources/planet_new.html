
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>NICFI Planet basemaps</title>
  <script>
    document.write('<base href="' + document.location + '" />');
  </script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/gh/digidem/leaflet-side-by-side@gh-pages/leaflet-side-by-side.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="  crossorigin=""/>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
			z-index: 1;
		}

		.controller-left {
			position: absolute;
			bottom: 0px;
			left: 10vw;
			z-index: 100;
			text-align: left;
		}

		.controller-right {
			position: absolute;
			bottom: 0px;
			right: 10vw;
			z-index: 100;
			text-align: right;
		}

		.background {
			background-color: yellow;
			opacity: 0.5;
		}

		.popover {
			background-color: yellow;
		}
		
		 
    </style>
	
	
	  <!-- Warning modal is shown only when API key is not provided (see script below) -->

</head>

<body layout="row" layout-wrap flex layout-fill layout-align="start start">
	<div id='map' ></div>
	
	<!-- Bootstrap Modal -->
	<div class="modal fade" id="warningModal" tabindex="-1" role="dialog" aria-labelledby="warningModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<h5 class="modal-title" id="warningModalLabel">Notice</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			  <span aria-hidden="true">&times;</span>
			</button>
		  </div>
		  <div class="modal-body">
			<p>
  Please be informed that the NICFI-Planet agreement, which provided high-resolution satellite imagery for tropical forest monitoring, concluded on January 23, 2025.
  Access to NICFI Planet Imagery within Collect Earth has been discontinued. No new monthly basemaps will be available after December 2024.
</p>
<p>
  To maintain access to similar data, you may:
</p>
<ul>
  <li>
    <strong>Contact Planet:</strong> Explore obtaining PlanetScope Tropical Mosaic access through the <a href="https://www.planet.com/tropical-forest-observatory/" target="_blank">Tropical Forest Observatory</a>.
  </li>
  <li>
    <strong>Use your own API key:</strong> Collect Earth now supports the integration of Planet imagery using your own access key.
  </li>
</ul>
<p>
  Historical imagery up to December 2024 remains accessible.
</p>

		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
		  </div>
		</div>
	  </div>
	</div>
	
	<div class="controller-left">
		<div class="input-group mb-3">
			<div class="input-group-prepend" style="margin-right:5px">
				<select id="leftPicker" class="selectpicker form-control" data-style="btn-primary">
				  <optgroup label="Biannual Mosaics">
					<option value="2015-12_2016-05" selected>2015/12 - 2016/05</option>
					<option value="2016-06_2016-11">2016/06 - 2016/11</option>
					<option value="2016-12_2017-05">2016/12 - 2017/05</option>
					<option value="2017-06_2017-11">2017/06 - 2017/11</option>
					<option value="2017-12_2018-05">2017/12 - 2018/05</option>
					<option value="2018-06_2018-11">2018/06 - 2018/11</option>
					<option value="2018-12_2019-05">2018/12 - 2019/05</option>
					<option value="2019-06_2019-11">2019/06 - 2019/11</option>
					<option value="2019-12_2020-05">2019/12 - 2020/05</option>
					<option value="2020-06_2020-08">2020/06 - 2020/08</option>
				  </optgroup>
				</select>
			</div>
			<div class="input-group-append">
				<div class="input-group-prepend">
					<select id="leftVizzPicker" class="selectpicker form-control" data-style="btn-primary">
				  	<option value="rgb">Natural</option>
					<option value="cir">CIR</option>
					<option value="ndvi">NDVI</option>
					<option value="ndwi">NDWI</option>
					<option value="msavi2">MSAVI2</option>
					<option value="mtvi2">MTVI2</option>
					<option value="vari">VARI</option>
					<option value="tgi">TGI</option>
				</select>
				<button type="button" class="btn btn-info infoButtonMsg" data-toggle="popover" data-placement="top" title="Remote Sensing Indices" data-html="true"  style="height:38px;margin-left:2px;" 
				data-content="<p><strong>CIR (Color Infrared)</strong><br><strong>Use:</strong> Used in remote sensing and agricultural monitoring for assessing plant health.<br><strong>Calculation:</strong> NIR displayed in red, Red in green, Green in blue.</p><p><strong>NDVI (Normalized Difference Vegetation Index)</strong><br><strong>Use:</strong> Monitoring vegetation health, indicates live green vegetation density.<br><strong>Calculation:</strong> (NIR - RED) / (NIR + RED)</p><p><strong>NDWI (Normalized Difference Water Index)</strong><br><strong>Use:</strong> Monitoring changes in water content of leaves and detecting water bodies.<br><strong>Calculation:</strong> (NIR - SWIR) / (NIR + SWIR)</p><p><strong>MSAVI2 (Modified Soil Adjusted Vegetation Index 2)</strong><br><strong>Use:</strong> Minimizes soil brightness influences on NDVI, useful in sparse vegetation areas.<br><strong>Calculation:</strong> (2 * NIR + 1 - sqrt((2 * NIR + 1)² - 8 * (NIR - RED))) / 2</p><p><strong>MTVI2 (Modified Triangular Vegetation Index 2)</strong><br><strong>Use:</strong> Assesses vegetation health with better sensitivity in high biomass regions.<br><strong>Calculation:</strong> 1.5 * (1.2 * (NIR - Green) - 2.5 * (Red - Green)) / sqrt((2 * NIR + 1)² - (6 * NIR - 5 * sqrt(Red)) - 0.5)</p><p><strong>VARI (Visible Atmospherically Resistant Index)</strong><br><strong>Use:</strong> Vegetation monitoring using visible wavelengths, useful for standard RGB imagery.<br><strong>Calculation:</strong> (Green - Red) / (Green + Red - Blue)</p><p><strong>TGI (Triangular Greenness Index)</strong><br><strong>Use:</strong> Estimates chlorophyll concentration in leaves, indicating plant health.<br><strong>Calculation:</strong> -0.5 * [190 * (Red - Green) - 120 * (Red - Blue)]</p>">
				  <span class="material-icons input-group-prepend">info</span>
				</button>
				</div>
				
			</div>
		</div>
	</div>

	<div class="controller-right">

		<div class="input-group mb-3">
			<div class="input-group-prepend"  style="margin-right:5px">
				<select id="rightPicker" class="selectpicker form-control" data-style="btn-primary">
				  <optgroup label="Biannual Mosaics">
				  	<option value="2015-12_2016-05">2015/12 - 2016/05</option>
					<option value="2016-06_2016-11">2016/06 - 2016/11</option>
					<option value="2016-12_2017-05">2016/12 - 2017/05</option>
					<option value="2017-06_2017-11">2017/06 - 2017/11</option>
					<option value="2017-12_2018-05">2017/12 - 2018/05</option>
					<option value="2018-06_2018-11">2018/06 - 2018/11</option>
					<option value="2018-12_2019-05">2018/12 - 2019/05</option>
					<option value="2019-06_2019-11">2019/06 - 2019/11</option>
					<option value="2019-12_2020-05">2019/12 - 2020/05</option>
					<option value="2020-06_2020-08">2020/06 - 2020/08</option>
				  </optgroup>

				</select>
			</div>
			<div class="input-group-append">
				<div class="input-group-prepend">
					<select id="rightVizzPicker" class="selectpicker form-control" data-style="btn-primary">
				  	<option value="rgb">Natural</option>
					<option value="cir">CIR</option>
					<option value="ndvi">NDVI</option>
					<option value="ndwi">NDWI</option>
					<option value="msavi2">MSAVI2</option>
					<option value="mtvi2">MTVI2</option>
					<option value="vari">VARI</option>
					<option value="tgi">TGI</option>
				</select>
				<button type="button" class="btn btn-info infoButtonMsg" data-toggle="popover" data-placement="top" title="Remote Sensing Indices" data-html="true" boundary="viewport" style="height:38px;margin-left:2px;"
				data-content="<p><strong>CIR (Color Infrared)</strong><br><strong>Use:</strong> Used in remote sensing and agricultural monitoring for assessing plant health.<br><strong>Calculation:</strong> NIR displayed in red, Red in green, Green in blue.</p><p><strong>NDVI (Normalized Difference Vegetation Index)</strong><br><strong>Use:</strong> Monitoring vegetation health, indicates live green vegetation density.<br><strong>Calculation:</strong> (NIR - RED) / (NIR + RED)</p><p><strong>NDWI (Normalized Difference Water Index)</strong><br><strong>Use:</strong> Monitoring changes in water content of leaves and detecting water bodies.<br><strong>Calculation:</strong> (NIR - SWIR) / (NIR + SWIR)</p><p><strong>MSAVI2 (Modified Soil Adjusted Vegetation Index 2)</strong><br><strong>Use:</strong> Minimizes soil brightness influences on NDVI, useful in sparse vegetation areas.<br><strong>Calculation:</strong> (2 * NIR + 1 - sqrt((2 * NIR + 1)² - 8 * (NIR - RED))) / 2</p><p><strong>MTVI2 (Modified Triangular Vegetation Index 2)</strong><br><strong>Use:</strong> Assesses vegetation health with better sensitivity in high biomass regions.<br><strong>Calculation:</strong> 1.5 * (1.2 * (NIR - Green) - 2.5 * (Red - Green)) / sqrt((2 * NIR + 1)² - (6 * NIR - 5 * sqrt(Red)) - 0.5)</p><p><strong>VARI (Visible Atmospherically Resistant Index)</strong><br><strong>Use:</strong> Vegetation monitoring using visible wavelengths, useful for standard RGB imagery.<br><strong>Calculation:</strong> (Green - Red) / (Green + Red - Blue)</p><p><strong>TGI (Triangular Greenness Index)</strong><br><strong>Use:</strong> Estimates chlorophyll concentration in leaves, indicating plant health.<br><strong>Calculation:</strong> -0.5 * [190 * (Red - Green) - 120 * (Red - Blue)]</p>">
				  <span class="material-icons">info</span>
				</button>
				<button type="button" id="apiKeyWarningBtn" class="btn btn-warning"
                    data-toggle="tooltip" data-placement="left"
                    title="You need to provide your own API key for Tropical Forest Observatory"
                    style="height:38px;margin-left:10px;display:none;">
                    <span class="material-icons">warning</span>
                </button>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Google Analytics -->
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-JDDM8SK1DH"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'G-JDDM8SK1DH', { 'anonymize_ip': true });
	</script>
	<!-- End Google Analytics -->
	
    <script>

	$('.infoButtonMsg').popover({trigger: 'focus'});

	// URL Parameters:
	// - latlngs: JSON array of polygon coordinates (required)
	// - planet_api_key: Planet API key for Tropical Forest Observatory access (required)
	// - planet_date_from: Start date for comparison (optional, defaults to '2016-06_2016-11')
	// - planet_date_to: End date for comparison (optional, defaults to latest available)
	// Example: planet.html?latlngs=[[[1,3],[4,4],[4,2],[1,3]]]&planet_api_key=YOUR_API_KEY
	const params = new URL(location.href).searchParams;
	var latlngs = JSON.parse( params.get('latlngs' ) );
	latlngs = latlngs || [[[14.869437,-90.816216],[14.869437,-90.815566],[14.868804,-90.815566],[14.868804,-90.816216],[14.869437,-90.816216]],[[14.869364,-90.81616],[14.869364,-90.816142],[14.869382,-90.816142],[14.869382,-90.81616],[14.869364,-90.81616]],[[14.869238,-90.81616],[14.869238,-90.816142],[14.869256,-90.816142],[14.869256,-90.81616],[14.869238,-90.81616]],[[14.869111,-90.81616],[14.869111,-90.816142],[14.869129,-90.816142],[14.869129,-90.81616],[14.869111,-90.81616]],[[14.868985,-90.81616],[14.868985,-90.816142],[14.869003,-90.816142],[14.869003,-90.81616],[14.868985,-90.81616]],[[14.868858,-90.81616],[14.868858,-90.816142],[14.868876,-90.816142],[14.868876,-90.81616],[14.868858,-90.81616]],[[14.869364,-90.81603],[14.869364,-90.816012],[14.869382,-90.816012],[14.869382,-90.81603],[14.869364,-90.81603]],[[14.869238,-90.81603],[14.869238,-90.816012],[14.869256,-90.816012],[14.869256,-90.81603],[14.869238,-90.81603]],[[14.869111,-90.81603],[14.869111,-90.816012],[14.869129,-90.816012],[14.869129,-90.81603],[14.869111,-90.81603]],[[14.868985,-90.81603],[14.868985,-90.816012],[14.869003,-90.816012],[14.869003,-90.81603],[14.868985,-90.81603]],[[14.868858,-90.81603],[14.868858,-90.816012],[14.868876,-90.816012],[14.868876,-90.81603],[14.868858,-90.81603]],[[14.869364,-90.8159],[14.869364,-90.815882],[14.869382,-90.815882],[14.869382,-90.8159],[14.869364,-90.8159]],[[14.869238,-90.8159],[14.869238,-90.815882],[14.869256,-90.815882],[14.869256,-90.8159],[14.869238,-90.8159]],[[14.869111,-90.8159],[14.869111,-90.815882],[14.869129,-90.815882],[14.869129,-90.8159],[14.869111,-90.8159]],[[14.868985,-90.8159],[14.868985,-90.815882],[14.869003,-90.815882],[14.869003,-90.8159],[14.868985,-90.8159]],[[14.868858,-90.8159],[14.868858,-90.815882],[14.868876,-90.815882],[14.868876,-90.8159],[14.868858,-90.8159]],[[14.869364,-90.81577],[14.869364,-90.815752],[14.869382,-90.815752],[14.869382,-90.81577],[14.869364,-90.81577]],[[14.869238,-90.81577],[14.869238,-90.815752],[14.869256,-90.815752],[14.869256,-90.81577],[14.869238,-90.81577]],[[14.869111,-90.81577],[14.869111,-90.815752],[14.869129,-90.815752],[14.869129,-90.81577],[14.869111,-90.81577]],[[14.868985,-90.81577],[14.868985,-90.815752],[14.869003,-90.815752],[14.869003,-90.81577],[14.868985,-90.81577]],[[14.868858,-90.81577],[14.868858,-90.815752],[14.868876,-90.815752],[14.868876,-90.81577],[14.868858,-90.81577]],[[14.869364,-90.81564],[14.869364,-90.815621],[14.869382,-90.815621],[14.869382,-90.81564],[14.869364,-90.81564]],[[14.869238,-90.81564],[14.869238,-90.815621],[14.869256,-90.815621],[14.869256,-90.81564],[14.869238,-90.81564]],[[14.869111,-90.81564],[14.869111,-90.815621],[14.869129,-90.815621],[14.869129,-90.81564],[14.869111,-90.81564]],[[14.868985,-90.81564],[14.868985,-90.815621],[14.869003,-90.815621],[14.869003,-90.81564],[14.868985,-90.81564]],[[14.868858,-90.81564],[14.868858,-90.815621],[14.868876,-90.815621],[14.868876,-90.81564],[14.868858,-90.81564]]]
	// For surveys where the start and end date is set!
	var fromMonthImage = params.get('planet_date_from' );
	var toMonthImage = params.get('planet_date_to' );

	// Planet API key from URL parameter (required for Tropical Forest Observatory access)
	const apiKey = params.get('planet_api_key');

	// Check if API key is provided
	if (!apiKey) {
		// Show warning modal
		$('#warningModal .modal-title').text('API Key Required');
		$('#warningModal .modal-body').html(
			'<p><strong>No Planet API key provided.</strong></p>' +
			'<p>To use Planet imagery, you need to provide your own API key from the ' +
			'<a href="https://www.planet.com/tropical-forest-observatory/" target="_blank">Tropical Forest Observatory</a>.</p>' +
			'<p>Please configure your Planet API key in Collect Earth settings.</p>'
		);
		$('#warningModal').modal('show');

		// Show warning icon button and initialize tooltip
		$('#apiKeyWarningBtn').show();
		$('#apiKeyWarningBtn').tooltip();
	}
	const INITIAL_TYPE = "rgb"; // before Benin we used "cir" as default
	
    var map = L.map('map');

    var polyline = L.polyline(latlngs, {color: 'yellow'}).addTo(map);

	map.fitBounds(polyline.getBounds())

	var planetLeftLayer;
	var planetRightLayer;
	var sideBySide;

	const planetFooter = 'Planet ' + new Date().getFullYear();
	
	// vizzType  = one of "rgb" , "cir" , "ndvi, " ndwi ,  "msavi2, mtvi2, vari, tgi, see here for explanation https://developers.planet.com/docs/basemaps/tile-services/indices/
	var getTileUrl = function( layerId, vizzType){

		// layerId -- > 2020-06_2020-08
		return( 'https://{s}/basemaps/v1/planet-tiles/planet_medres_normalized_analytic_'+layerId+'_mosaic/gmap/{z}/{x}/{y}?api_key='+apiKey+'&proc='+vizzType);
	}
	
	var getTileLayer = function( layerId, vizzType){
		var layer = L.tileLayer(
			getTileUrl(layerId, vizzType),
			{
				attribution: planetFooter,
				subdomains: ['tiles0.planet.com', 'tiles1.planet.com', 'tiles2.planet.com', 'tiles3.planet.com'],
				errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='
			}
		);

		// Add error handling for tile load failures
		layer.on('tileerror', function(error) {
			console.warn('Failed to load Planet tile:', error.tile.src);
		});

		return layer;
	}

	var initialize = function( leftLayerId, rightLayerId){
		$('#leftPicker').val( leftLayerId );
		$('#rightPicker').val( rightLayerId );
		$('#rightVizzPicker').val( INITIAL_TYPE );
		$('#leftVizzPicker').val( INITIAL_TYPE );
		
		planetLeftLayer = getTileLayer(leftLayerId, INITIAL_TYPE ).addTo(map);
		planetRightLayer = getTileLayer(rightLayerId, INITIAL_TYPE).addTo(map);

		return L.control.sideBySide(planetLeftLayer, planetRightLayer).addTo(map);
	}

	var loadSingleSide = function( layerId, vizzType, rightSide){

		if( rightSide ){
			map.removeLayer( planetRightLayer);
		}else{
			map.removeLayer( planetLeftLayer);
		}

		var planetLayer = getTileLayer(layerId, vizzType).addTo(map);

		if( rightSide ){
			planetRightLayer = planetLayer;
			sideBySide.setRightLayers( planetLayer ).addTo(map);
		}else{
			planetLeftLayer = planetLayer;
			sideBySide.setLeftLayers( planetLayer ).addTo(map);
		}
	}

	var getMonthName = function(idx) {

		var objDate = new Date();
		objDate.setDate(1);
		objDate.setMonth(idx-1);

		var locale = "default",
		month = objDate.toLocaleString(locale, { month: "long" });

		return month;
	}
	
	var lastMonthAdded; 
	
	// Function to generate the optgroup for monthly mosaics
	function generateMonthlyMosaicsOptgroup() {
		// Define constants
		const START_YEAR = 2020;
		const START_MONTH = 9; // September 2020
		const DAY_WITH_NEW_MONTHLY_BASEMAP = 8;

		// Get current date for determining available monthly basemaps
		const today = new Date();
		const currentYear = today.getFullYear();
		const currentMonth = today.getMonth() + 1; // Months are 0-based
		const currentDay = today.getDate();

		// Initialize the optgroup HTML
		let optgroup = "<optgroup label=\"Monthly Mosaics (from September 2020)\">";

		// Loop through years and months
		for (let year = START_YEAR; year <= currentYear; year++) {
			for (let month = 1; month <= 12; month++) {
				
				if (
					(year === START_YEAR && month < START_MONTH) || // Skip months before September 2020
					(year === currentYear && month > currentMonth - 1) || // Skip months after current month
					(year === currentYear && month === currentMonth - 1 && currentDay <= DAY_WITH_NEW_MONTHLY_BASEMAP) || // Skip last mont if the planet imagery is not updated yer (before the 8th of the month to be sure
					(year === currentYear - 1 && currentMonth === 1 && month === 12 && currentDay <= DAY_WITH_NEW_MONTHLY_BASEMAP) // Special case for January
				) {
					continue;
				}

				// Generate the display name and value for the option
				const name = getMonthName(month) + " " + year;
				const value = year +"-"+month.toString().padStart(2, "0");

				lastMonthAdded = value;

				// Add the option to the optgroup
				optgroup += `<option value='${value}'>${name}</option>`;
			}
		}

		// Close the optgroup
		optgroup += "</optgroup>";

		return optgroup;
	}

	var loadLeft = function(){loadSingleSide( $('#leftPicker').val(), $('#leftVizzPicker').val(), false );};
	var loadRight = function(){loadSingleSide( $('#rightPicker').val(), $('#rightVizzPicker').val(), true );};

	$('#leftPicker').on('changed.bs.select', loadLeft);
	$('#leftVizzPicker').on('changed.bs.select', loadLeft);

	$('#rightPicker').on('changed.bs.select', loadRight);
	$('#rightVizzPicker').on('changed.bs.select', loadRight);
	
	$('[data-toggle="tooltip"]').tooltip();
	
	// create opt group
	var optgroup = generateMonthlyMosaicsOptgroup();

	// create select
	$('#leftPicker').append(optgroup);
	$('#rightPicker').append(optgroup);	

	fromMonthImage = fromMonthImage || '2016-06_2016-11';
	toMonthImage = toMonthImage || lastMonthAdded;

	sideBySide = initialize(fromMonthImage, toMonthImage);

    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"922c117d7d9dea6e","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.1.0","token":"8a1eede1275a47738e098887c84bd924"}' crossorigin="anonymous"></script>
</body>
</html>
